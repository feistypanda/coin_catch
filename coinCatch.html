<!DOCTYPE html>
<html> 
 <head>
    <title>coin catch</title> 
</head>
 <body>
    <p align="center"> 
      <canvas id="mycanvas"></canvas> 
    </p>
 </body>
 
 
 <script src="/Users/leomilberg/Documents/ProcessingJS/lib/processing.js"></script> 
 
 <script>
    var sketchProc = function(processingInstance) {
     with (processingInstance) {
size(800, 800); 
frameRate(60);
var groundHeight = height/5;
var keyIsPressed = false;
var score = 0;
var lives = 1;
var page = 1;
var dieDelay = 0;
var moneyX = width/1.08108108108;
var moneySize = width/10;
var eStarts = [200, 300, 600];
var moneyY = round(random((moneySize/2) + width/20, (height - groundHeight) - moneySize/2));

//speeds and sizes of mobs and player
var spriteSp = width/100, spriteSi = width/20, enemySps = [width/200, width/266.66, width/400], enemySi = width/40, moneySize = width/10; 

//background settings
var groundHeight = height/5, topbarHeight = 0;

var toRad = function(d){
    return d*PI/180;
};


var Sprite = function(x, y, size, angle, speed, color){
    this.x = x;
    this.y = y;
    this.size = size;
    this.angle = angle;
    this.speed = speed;
    this.color = color;
}

Sprite.prototype.draw = function(){
    pushMatrix();
    translate(this.x, this.y);
    rotate(this.angle + toRad(90));
    fill(this.color);
    noStroke();
    ellipse(0, 0, this.size, this.size);
    stroke(0);
    strokeWeight(this.size/8);
    point(0 - this.size/5, 0 - this.size/5);
    point(0 + this.size/5, 0 - this.size/5);
    noFill();
    arc(0, this.size/6, this.size/2, this.size/4, 0, PI);
    popMatrix();
};

Sprite.prototype.update = function() {
    var xs = cos(this.angle)*this.speed;
    var ys = sin(this.angle)*this.speed; 
    this.x += xs;
    this.y += ys;
    this.y = constrain(this.y, this.size * 1.5, height - groundHeight - this.size/2);
    this.angle = constrain(this.angle, toRad(-45), toRad(45));
    if(this.x > width){
        this.x = 0;
    }
};

var Enemy = function(x, y, s, a, lastA){
    this.x = x;
    this.y = y;
    this.s = s;
    this.xs = 0;
    this.ys = 0;
    this.size = enemySi;
    this.a = 0;
    this.lastA = lastA;
};

Enemy.prototype.draw = function() {
    pushMatrix();
    translate(this.x, this.y);
    noStroke();
    fill(255, 0, 0);
    ellipse(0, 0, this.size, this.size);
    stroke(0);
    strokeWeight(width/80);
    point(0, 0);
    stroke(255);
    strokeWeight(width/200);
    point(0, 0);
    popMatrix();
};

Enemy.prototype.update = function(){
    var x = this.x;
    var y = -this.y;

    var ax = 100
    var ay = 0

    var x0 = sprite1.x;
    var y0 = -sprite1.y;

    var bx = x0 - x;
    var by = y0 - y;

    var isNegative = ax * by - ay * bx < 0

    vecs = [x - x0, y - y0];
    vec0 = [100, 0];
    this.lastA = this.a;
    var dot = (vecs[0]*vec0[0])+(vecs[1]*vec0[1]);
    vecs[0] = sq(vecs[0]);
    vecs[1] = sq(vecs[1]);
    vec0[0] = sq(vec0[0]);
    vec0[1] = sq(vec0[1]);
    var angle = (acos(dot / (sqrt(vecs[0] + vecs[1]) * sqrt(vec0[0]+vec0[1]))) + toRad(
        180))%(PI*2);
    
    if(isNegative){
        angle = -angle;
    }else{
        angle = +angle;
    }
    this.a = angle;
    this.xs = cos(this.a)*this.s;
    this.ys = sin(this.a)*this.s;
    this.x += this.xs;
    this.y += this.ys;
    this.y = constrain(this.y, sprite1.size+(this.size)/2, height - groundHeight - this.size/2);
    this.x = constrain(this.x, (this.size)/2, width - this.size/2);
    pushMatrix();
    translate(this.x, this.y);
    rotate(this.a);
    stroke(0);
    line(0, 0, 10, 0);
    popMatrix();
};

var sprite1 = new Sprite(width/2, height/2, spriteSi, toRad(0), spriteSp, color(255, 255, 255));

var enemie1 = new Enemy(width/8, height/4, enemySps[0], 0, 0);
var enemie2 = new Enemy(width/8, height/2.66, enemySps[1], 0, 0);
var enemie3 = new Enemy(width/8, height/1.33, enemySps[2], 0);

var enemys = [enemie1, enemie2, enemie3];

var colosionTest = function(x1, y1, s1, x2, y2, s2){
    return dist(x1, y1, x2, y2) < (s1/2)+(s2/2);
};

var home = function(){
    page = 0;
    background(0, 255, 255);
    textSize(150);
    fill(200, 200, 0);
    text("CATCH", 150, 250);
    pushMatrix();
    translate(200, 80);
    rotate(PI/4);
    fill(255, 255, 0);
    text("COIN", 0, 0);
    popMatrix();
};

var play = function(){
    page = 1;
    background(0, 255, 255);
    fill(0, 255, 0);
    noStroke();
    rect(0, height - groundHeight, width, groundHeight);
    fill(150);
    rect(0, 0, width, sprite1.size);
    fill(255);
    textSize(sprite1.size/2);
    text("score: " + score, width/80, (sprite1.size/2) + (sprite1.size/8));
    fill(200, 200, 0);
    ellipse(moneyX, moneyY, moneySize, moneySize);
    fill(255, 255, 0);
    ellipse(moneyX, moneyY, moneySize - width/40, moneySize - width/40);
    fill(200, 200, 0);
    textSize(width/16.666);
    text("$", moneyX - (moneySize/6), moneyY + (moneySize/5.5));
    stroke(0);
    sprite1.draw();
    sprite1.update();
    for (var i = 0; i < enemys.length; i++) {
        enemys[i].draw();
        enemys[i].update();
    }
    if(colosionTest(sprite1.x, sprite1.y, sprite1.size, moneyX, moneyY, moneySize)){
        moneyY = round(random((moneySize/2) + width/20, (height - groundHeight) - moneySize/2));
        score++;
        sprite1.speed += 0.125;
        sprite1.speed = constrain(sprite1.speed, 0, 15);
    }
    if(sprite1.y >= (height - groundHeight) - (sprite1.size/2)){
        die();
    }
    if(keyIsPressed){
        if(keyCode == UP){
            sprite1.angle -= toRad(5);
        }else if(keyCode == DOWN){
            sprite1.angle += toRad(5);
        }
    }
};

var die = function(){
    page = 2;
    if(dieDelay >= 50){
        background(0);
        fill(255);
        textSize(width/5.5);
        text("YOU DIED!", width/40, width/4);
        textSize(width/10);
        text("click to try again", width/8.333, width/1.25);
        textSize(width/16);
        fill(0, 255, 0);
        text("you scored: " + score, width/4, width/2);
    }else if (dieDelay < 50){
        noStroke();
        fill(0, 0, 0, dieDelay);
        rect(0, 0, width, height);
    }
    dieDelay++;
};

draw = function(){
    if(page === 0){
        home();
    }else if(page === 1){
        play();
    }else if(page === 2){
        die();
    }
};

keyPressed = function(){
    keyIsPressed = true;
};

keyReleased = function(){
    keyIsPressed = false;
};

mousePressed = function(){
    if(page === 2){
        
        sprite1.x = width/2;
        sprite1.y = height/2;
        sprite1.angle = toRad(0);
        sprite1.speed = width/100;
        score = 0;
        lives = 1;
        dieDelay = 0;
        moneyY = round(random((moneySize/2) + width/20, (height - groundHeight) - moneySize/2));
        for(var i in enemys){
            enemys[i].x = 100;
            enemys[i].y = eStarts[i];
        }
        play();                
    }
};
}   
};

    var canvas = document.getElementById("mycanvas"); 
    var processingInstance = new Processing(canvas, sketchProc); 
 </script>

</html>